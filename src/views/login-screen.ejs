<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Desenvolvimento Web</title>

    <!--css-->
    <link rel="stylesheet" href="estilos/iziToast.css">
    <link href="estilos/global.css" rel="stylesheet"/>
    <link href="estilos/login.css" rel="stylesheet"/>
    <link
        rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css"
        integrity="sha384-zCbKRCUGaJDkqS1kPbPd7TveP5iyJE0EjAuZQTgFLD2ylzuqKfdKlfG/eSrtxUkn"
        crossorigin="anonymous"
    />
</head>
<body>    
  <section class="login">        
      <div class="login__form">
          <a class="login__logo" href="#">
              <img src="assets/fp3.png" alt="logo" class="img-fluid" />
          </a>
          <div class="login__welcome">
              <span>Bem-vindo de volta</span>
              <h1>Faça Seu Login</h1>
          </div>
          <form id="formLogin">
            <div class="login__field">
              <label for="user">Usuário:</label>
              <input type="text" id="email" name="email" placeholder="Insira seu usuário">
            </div>
            <div class="login__field">
              <label for="password">Senha:</label>
              <input type="password" id="password" name="password" placeholder="********">
            </div>
            <div class="login__checkbox">
              <input type ="checkbox" id="remember-me" value="Yes">
              <label for="remember-me">Lembrar de mim</label><br>
            </div>
            <div class="login__buttons">
              <button type="submit" class="login__login-button">Entrar</button>
              <a href="/cadastrar">
                  <button type="button" class="login__signup-button">Cadastrar-se</button>
              </a>
            </div>
          </form>
      </div>        
      <div class="login__banner">
        <img src="assets/back-login.png" alt=""/>
      </div>
  </section>

  <script src="scripts/iziToast.js" type="text/javascript"></script>
  <script src="scripts/field-validation.js" type="text/javascript"></script>
  <script>
    var emailField = document.getElementById('email');
    var passwordField = document.getElementById('password');
    var formLogin = document.getElementById('formLogin');

    formLogin.addEventListener('submit', function(e){
      e.preventDefault();

      let email = emailField.value;
      let password = passwordField.value;
      
      fetch('/entrar',{
        method: 'POST',
        body: JSON.stringify({
          email,password
        }),
				headers: {
					'content-type': 'application/json'
				}
      }).then(data => {
        if(data.status !== 200 && data.status !== 201){
					throw new Error();
				}
        iziToast.success({
						title: 'Sucesso',
						message: 'Usuário logado com sucesso!',
						position: 'bottomLeft'
				});
        window.location.replace(data.url);
      }).catch(error => {
        iziToast.error({
						title: 'Erro',
						message: 'Erro ao logar, tente novamente!',
						position: 'bottomLeft'
				});
        cleanFields();
      })
    })

    emailField.addEventListener('input',function(){
			var re = /\S+@\S+\.\S+/;
			let email = emailField.value.toString();
			if(email.length === 0){
				emailField.classList.remove('invalid');
				emailField.classList.remove('valid');
				return;
			}
			validateField(!re.test(email),emailField)
		});

    passwordField.addEventListener('input', function(){
			let password = passwordField.value.toString();
			if(password.length === 0){
				passwordField.classList.remove('invalid');
				passwordField.classList.remove('valid');
				return;
			}
			validateField(password.length <= 5, passwordField);
		},false);

		function cleanFields(){
			resetStateField(nomeField);
		 	resetStateField(emailField);
		 	resetStateField(passwordField);
		}

  </script>
</body>
</html>